"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var babel_plugin_ts_optchain_1 = require("babel-plugin-ts-optchain");
var createMacro = require("babel-plugin-macros").createMacro;
function findImportDeclaration(t, name, path) {
    var bindings = path.scope.bindings;
    var binding = bindings[name];
    if (!binding) {
        return findImportDeclaration(t, name, path.scope.parent.path);
    }
    if (t.isImportDeclaration(binding.path.parentPath.node)) {
        return binding.path.parentPath.node;
    }
}
function transfromMacroImport(t, path) {
    if (!t.isIdentifier(path.node.callee)) {
        return;
    }
    var name = path.node.callee.name;
    var importDecl = findImportDeclaration(t, name, path);
    if (importDecl) {
        importDecl.source.value = babel_plugin_ts_optchain_1.RUNTIME_IMPORT;
    }
}
exports.default = createMacro(function tsOptChainMacro(macro) {
    var t = macro.babel.types;
    for (var _i = 0, _a = Object.keys(macro.references); _i < _a.length; _i++) {
        var key = _a[_i];
        var paths = macro.references[key];
        for (var _b = 0, paths_1 = paths; _b < paths_1.length; _b++) {
            var path = paths_1[_b];
            if (t.isCallExpression(path.parent)) {
                var callPath = path.parentPath;
                transfromMacroImport(t, callPath);
                babel_plugin_ts_optchain_1.transformOptchainCall(t, callPath);
            }
        }
    }
    return {
        keepImports: true,
    };
});
//# sourceMappingURL=macro.js.map